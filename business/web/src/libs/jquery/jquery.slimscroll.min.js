/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.3
 *
 */
(function(a){a.fn.extend({slimScroll:function(b){var c={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var d=a.extend(c,b);this.each(function(){var w,u,j,y,n,p,z,i,k="<div></div>",q=30,s=false;var A=a(this);if(A.parent().hasClass(d.wrapperClass)){var h=A.scrollTop();r=A.parent().find("."+d.barClass);e=A.parent().find("."+d.railClass);C();if(a.isPlainObject(b)){if("height" in b&&b.height=="auto"){A.parent().css("height","auto");A.css("height","auto");var B=A.parent().parent().height();A.parent().css("height",B);A.css("height",B)}if("scrollTo" in b){h=parseInt(d.scrollTo)}else{if("scrollBy" in b){h+=parseInt(d.scrollBy)}else{if("destroy" in b){r.remove();e.remove();A.unwrap();return}}}v(h,false,true)}return}else{if(a.isPlainObject(b)){if("destroy" in b){return}}}d.height=(d.height=="auto")?A.parent().height():d.height;var g=a(k).addClass(d.wrapperClass).css({position:"relative",overflow:"hidden",width:d.width,height:d.height});A.css({overflow:"hidden",width:d.width,height:d.height});var e=a(k).addClass(d.railClass).css({width:d.size,height:"100%",position:"absolute",top:0,display:(d.alwaysVisible&&d.railVisible)?"block":"none","border-radius":d.railBorderRadius,background:d.railColor,opacity:d.railOpacity,zIndex:90});var r=a(k).addClass(d.barClass).css({background:d.color,width:d.size,position:"absolute",top:0,opacity:d.opacity,display:d.alwaysVisible?"block":"none","border-radius":d.borderRadius,BorderRadius:d.borderRadius,MozBorderRadius:d.borderRadius,WebkitBorderRadius:d.borderRadius,zIndex:99});var l=(d.position=="right")?{right:d.distance}:{left:d.distance};e.css(l);r.css(l);A.wrap(g);A.parent().append(r);A.parent().append(e);if(d.railDraggable){r.bind("mousedown",function(D){var E=a(document);j=true;t=parseFloat(r.css("top"));pageY=D.pageY;E.bind("mousemove.slimscroll",function(F){currTop=t+F.pageY-pageY;r.css("top",currTop);v(0,r.position().top,false)});E.bind("mouseup.slimscroll",function(F){j=false;m();E.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(D){D.stopPropagation();D.preventDefault();return false})}e.hover(function(){f()},function(){m()});r.hover(function(){u=true},function(){u=false});A.hover(function(){w=true;f();m()},function(){w=false;m()});A.bind("touchstart",function(E,D){if(E.originalEvent.touches.length){n=E.originalEvent.touches[0].pageY}});A.bind("touchmove",function(E){if(!s){E.originalEvent.preventDefault()}if(E.originalEvent.touches.length){var D=(n-E.originalEvent.touches[0].pageY)/d.touchScrollStep;v(D,true);n=E.originalEvent.touches[0].pageY}});C();if(d.start==="bottom"){r.css({top:A.outerHeight()-r.outerHeight()});v(0,true)}else{if(d.start!=="top"){v(a(d.start).position().top,null,true);if(!d.alwaysVisible){r.hide()}}}o();function x(D){if(!w){return}var D=D||window.event;var F=0;if(D.wheelDelta){F=-D.wheelDelta/120}if(D.detail){F=D.detail/3}var E=D.target||D.srcTarget||D.srcElement;if(a(E).closest("."+d.wrapperClass).is(A.parent())){v(F,true)}if(D.preventDefault&&!s){D.preventDefault()}if(!s){D.returnValue=false}}function v(I,F,E){s=false;var H=I;var G=A.outerHeight()-r.outerHeight();if(F){H=parseInt(r.css("top"))+I*parseInt(d.wheelStep)/100*r.outerHeight();H=Math.min(Math.max(H,0),G);H=(I>0)?Math.ceil(H):Math.floor(H);r.css({top:H+"px"})}z=parseInt(r.css("top"))/(A.outerHeight()-r.outerHeight());H=z*(A[0].scrollHeight-A.outerHeight());if(E){H=I;var D=H/A[0].scrollHeight*A.outerHeight();D=Math.min(Math.max(D,0),G);r.css({top:D+"px"})}A.scrollTop(H);A.trigger("slimscrolling",~~H);f();m()}function o(){if(window.addEventListener){this.addEventListener("DOMMouseScroll",x,false);this.addEventListener("mousewheel",x,false)}else{document.attachEvent("onmousewheel",x)}}function C(){p=Math.max((A.outerHeight()/A[0].scrollHeight)*A.outerHeight(),q);r.css({height:p+"px"});var D=p==A.outerHeight()?"none":"block";r.css({display:D})}function f(){C();clearTimeout(y);if(z==~~z){s=d.allowPageScroll;if(i!=z){var D=(~~z==0)?"top":"bottom";A.trigger("slimscroll",D)}}else{s=false}i=z;if(p>=A.outerHeight()){s=true;return}r.stop(true,true).fadeIn("fast");if(d.railVisible){e.stop(true,true).fadeIn("fast")}}function m(){if(!d.alwaysVisible){y=setTimeout(function(){if(!(d.disableFadeOut&&w)&&!u&&!j){r.fadeOut("slow");e.fadeOut("slow")}},1000)}}});return this}});a.fn.extend({slimscroll:a.fn.slimScroll})})(jQuery);